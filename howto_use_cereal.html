<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BioC++: How to serialise SeqAn data structures</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="biocpp.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="biocpp_logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BioC++
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">The Modern C++ libraries for Bioinformatics.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('howto_use_cereal.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How to serialise SeqAn data structures </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md68">Motivation</a></li>
<li class="level1"><a href="#autotoc_md69">Storing</a></li>
<li class="level1"><a href="#autotoc_md70">Loading</a></li>
<li class="level1"><a href="#autotoc_md71">Storing &amp; Loading in the same function</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md__home_hannes_devel_bio_core_doc_howto_use_cereal_index"></a></p>
<p>This HowTo shows how to serialise data structures with <a href="https://uscilab.github.io/cereal/">cereal</a>. Every SeqAn data structure which is is marked as cerealisable can be used.</p>
<table class="doxtable">
<tr>
<th>Difficulty</th><td>Easy</td></tr>
<tr>
<th>Duration</th><td>15 min</td></tr>
<tr>
<th>Prerequisite tutorials</th><td>No prerequisites </td></tr>
<tr>
<th>Recommended reading</th><td></td></tr>
</table>
<h1><a class="anchor" id="autotoc_md68"></a>
Motivation</h1>
<p>Storing and loading data, for example a <a href="https://en.wikipedia.org/wiki/FM-index">FM-Index</a>, is a common use case. Thanks to the cereal library doing so is incredible easy. This page will show you how to use cereal in SeqAn. As an example data structure we will use a <code><a class="elRef" target="_blank" href="https://en.cppreference.com/w/cpp/container/vector.html">std::vector</a></code>, but as already mentioned, any SeqAn data structure that is documented as cerealisable can be used.</p>
<h1><a class="anchor" id="autotoc_md69"></a>
Storing</h1>
<p>Storing a data structure is as easy as using the <code>cereal::BinaryOutputArchive</code>. In order to use it, you need to include</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cereal/archives/binary.hpp&gt;</span> <span class="comment">// includes the cereal::BinaryOutputArchive</span></div>
</div><!-- fragment --><p> Note that stl data types, like <code><a class="elRef" target="_blank" href="https://en.cppreference.com/w/cpp/container/vector.html">std::vector</a></code>, are not automatically usable with cereal. You need to include the respective header, e.g. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cereal/types/vector.hpp&gt;</span>    <span class="comment">// includes cerealisation support for std::vector</span></div>
</div><!-- fragment --><p> In SeqAn, our data structures have integrated cereal support so there is no need to include an extra header.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/header/fstream.html">fstream</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/header/vector.html">vector</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;cereal/archives/binary.hpp&gt;</span> <span class="comment">// includes the cereal::BinaryOutputArchive</span></div>
<div class="line"><span class="comment"></span><span class="preprocessor">#include &lt;cereal/types/vector.hpp&gt;</span>    <span class="comment">// includes cerealisation support for std::vector</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="preprocessor">#include &lt;bio/test/tmp_filename.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Written for std::vector, other types also work.</span></div>
<div class="line"><span class="keywordtype">void</span> store(<a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int16_t&gt;</a> <span class="keyword">const</span> &amp; data, bio::test::tmp_filename &amp; tmp_file)</div>
<div class="line">{</div>
<div class="line">    <a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/io/basic_ofstream.html">std::ofstream</a> os(tmp_file.get_path(), std::ios::binary); <span class="comment">// Where output should be stored.</span></div>
<div class="line">    cereal::BinaryOutputArchive archive(os);                 <span class="comment">// Create an ouput archive from the output stream.</span></div>
<div class="line">    archive(data);                                           <span class="comment">// Store data.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// The following example is for an std::vector but any bio data structure that is documented as serialisable</span></div>
<div class="line">    <span class="comment">// could be used, e.g. bio::fm_index.</span></div>
<div class="line">    bio::test::tmp_filename tmp_file{<span class="stringliteral">&quot;data.out&quot;</span>}; <span class="comment">// This is a temporary file, use any other filename.</span></div>
<div class="line"> </div>
<div class="line">    <a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int16_t&gt;</a> vec{1,2,3,4};</div>
<div class="line">    store(vec, tmp_file);                            <span class="comment">// Calls store on a std::vector.</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="abasic_ofstream_html"><div class="ttname"><a href="https://en.cppreference.com/w/cpp/io/basic_ofstream.html">std::ofstream</a></div></div>
<div class="ttc" id="afstream_html"><div class="ttname"><a href="https://en.cppreference.com/w/cpp/header/fstream.html">fstream</a></div></div>
<div class="ttc" id="avector_html"><div class="ttname"><a href="https://en.cppreference.com/w/cpp/header/vector.html">vector</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md70"></a>
Loading</h1>
<p>Loading a data structure is as easy as using the <code>cereal::BinaryInputArchive</code>. In order to use it, you need to include</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cereal/archives/binary.hpp&gt;</span> <span class="comment">// includes the cereal::BinaryInputArchive and cereal::BinaryOutputArchive</span></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/header/fstream.html">fstream</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/header/vector.html">vector</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;cereal/archives/binary.hpp&gt;</span> <span class="comment">// includes the cereal::BinaryInputArchive and cereal::BinaryOutputArchive</span></div>
<div class="line"><span class="comment"></span><span class="preprocessor">#include &lt;cereal/types/vector.hpp&gt;</span>    <span class="comment">// includes cerealisation support for std::vector</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;bio/meta/debug_stream.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;bio/test/tmp_filename.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Written for std::vector, other types also work.</span></div>
<div class="line"><span class="keywordtype">void</span> load(<a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int16_t&gt;</a> &amp; data, bio::test::tmp_filename &amp; tmp_file)</div>
<div class="line">{</div>
<div class="line">    <a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/io/basic_ifstream.html">std::ifstream</a> is(tmp_file.get_path(), std::ios::binary); <span class="comment">// Where input can be found.</span></div>
<div class="line">    cereal::BinaryInputArchive archive(is);                  <span class="comment">// Create an input archive from the input stream.</span></div>
<div class="line">    archive(data);                                           <span class="comment">// Load data.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Written for std::vector, other types also work.</span></div>
<div class="line"><span class="keywordtype">void</span> store(<a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int16_t&gt;</a> <span class="keyword">const</span> &amp; data, bio::test::tmp_filename &amp; tmp_file)</div>
<div class="line">{</div>
<div class="line">    <a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/io/basic_ofstream.html">std::ofstream</a> os(tmp_file.get_path(), std::ios::binary); <span class="comment">// Where output should be stored.</span></div>
<div class="line">    cereal::BinaryOutputArchive archive(os);                 <span class="comment">// Create an ouput archive from the output stream.</span></div>
<div class="line">    archive(data);                                           <span class="comment">// Store data.</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// The following example is for an std::vector but any seqan3 data structure that is documented as serialisable</span></div>
<div class="line">    <span class="comment">// could be used, e.g. bio::fm_index.</span></div>
<div class="line">    bio::test::tmp_filename tmp_file{<span class="stringliteral">&quot;data.out&quot;</span>}; <span class="comment">// This is a temporary file, use any other filename.</span></div>
<div class="line"> </div>
<div class="line">    <a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int16_t&gt;</a> vec{1,2,3,4};</div>
<div class="line">    store(vec, tmp_file);                            <span class="comment">// Calls store on a std::vector.</span></div>
<div class="line">    <span class="comment">// This vector is needed to load the information into it.</span></div>
<div class="line">    <a class="codeRef" target="_blank" href="https://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;int16_t&gt;</a> vec2;</div>
<div class="line">    load(vec2, tmp_file);                            <span class="comment">// Calls load on a std::vector.</span></div>
<div class="line"> </div>
<div class="line">    bio::debug_stream &lt;&lt; vec2 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;             <span class="comment">// Prints [1,2,3,4].</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="abasic_ifstream_html"><div class="ttname"><a href="https://en.cppreference.com/w/cpp/io/basic_ifstream.html">std::ifstream</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md71"></a>
Storing &amp; Loading in the same function</h1>
<p>In the example above loading and storing was encapsulated in separated functions. It is possible to use <code>cereal::BinaryInputArchive</code> and <code>cereal::BinaryOutputArchive</code> in one function, but then it is necessary to encapsulate each in an individual scope (using extra braces<code>{}</code>). The reason for this is that the output/input stream handle of an archive is closed on deconstruction and only then is the file properly written an accessible by another filehandle. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.16-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <div id="list_bottom_right" style="text-align:right; float:left; color:black; padding: 0px 0px 0px 10px"></div>
    <script type="text/javascript" charset="utf-8" src="version.js"></script>
    <li class="footer">Generated on Sun Jun 12 2022 17:23:28 for BioC++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
